---
title: 'Iframe'
---

<Warning>
  Advanced! Developers with backend access to your LMS/Website is required for this method to work
</Warning>

<Steps>
  <Step title="Copy the Iframe">
    Each activity requires a specific iframe configuration. Here's the base template:

    ```html
    <iframe
      id="replay-iframe"
      src="https://app.replay.sale/api/iframe/launch?activityId=403dded8-6a20-410d-a234-75c0f35f44f0&activityType=premade-roleplay&integrationJwt=<INPUT_INTEGRATION_JWT>"
      width="100%"
      height="100%"
      frameborder="0"
      border="none"
      allow="microphone; camera; clipboard-write; downloads;"
      style="position: absolute; left: 0; right: 0; bottom: 0; top: 0;"
    ></iframe>
    ```

    <Accordion title="Do I have to copy the iframe every time? Or can I make it more dynamic?">
      __You do not need to copy the iframe every time.__ You are free to make it more dynamic by generating the iframe on your side, but in order to get the user into the correct activity, we will need the following:

      **src attributes:**
      * `a base url` (typically https://yourcompany.replay.sale)
      * `activityId` (the unique id of the activity you want to load)
      * `activityType` (the type of activity you want to load)
      * `integrationJwt` (a signed JWT that has the required claims. See step 2 for more details)

      **iframe attributes:**
      * `allow="microphone; camera; clipboard-write; downloads;"`
        * `microphone` and `camera` allow us to record the user
        * `clipboard-write` allows the user to copy a link to their roleplay analysis
        * `downloads` allows the user to download their audio / video recording
    </Accordion>

  </Step>

  <Step title="Generate a Signed JWT">
    You must generate a unique JWT for each user using your secret key. The JWT requires these claims:

    * `learnerName` - User's name (first, last, or both)
    * `uniqueIdentifier` - Your database's unique identifier for this user (UUID, email, etc.)
    * `originDomain` - Your company's domain (e.g., `app.replay.sale`)

    <Warning>
      Need a secret key or lost yours? Contact us through email (hello@replay.sale) or Slack
    </Warning>

  </Step>

  <Step title="Implement the Integration">
    1. Generate the signed JWT for your user
    2. Replace `<INPUT_INTEGRATION_JWT>` in the iframe src with your signed JWT
    3. Load the iframe

    <Note>
      Best practice: Create a function that handles JWT generation and iframe src updates before loading
    </Note>

  </Step>

  <Step title="Test Your Integration">
    Load your page and verify that:
    * The iframe loads successfully
    * User information is correct
    * Recording permissions work
    * Downloads function properly

    Need help? Contact us at hello@replay.sale

  </Step>
</Steps>

## Code Examples

<CodeGroup>
      ```javascript Sign your own JWT
      // Your backend route should use a function like this to sign the JWT
      const signReplayJwt = () => {
        const uniqueIdentifier = "asdf1234"; // Replace with the actual unique identifier of your user
        const learnerName = "John Doe"; // Replace with your actual learner name
        const originDomain = "example.com"; // Replace with your domain

        const payload = {
          uniqueIdentifier,
          learnerName,
          originDomain,
        };

        const secret = process.env.REPLAY_SECRET; // Replace with your actual secret that you got from Replay

        const integrationToken = jwt.sign(payload, secret, { expiresIn: "1h" });

        return integrationToken;
      };
      ```

      ```html Iframe Example
      <!-- Once signed and finished, your iframe will end up looking like this -->
      <iframe
        id="replay-iframe"
        src="https://app.replay.sale/api/iframe/launch?activityId=bfaba734-35bf-41a2-9ca5-bbc4f5f04888&activityType=script&type=iframe&integrationJwt={}"
        width="100%"
        height="100%"
        frameborder="0"
        border="none"
        allow="microphone; camera; clipboard-write;"
        style="
          background-color: red;
          position: absolute;
          left: 0;
          right: 0;
          bottom: 0;
          top: 0;
        "
      ></iframe>
      ```

      ```html Complete HTML Example
      <!DOCTYPE html>
      <html lang="en">
        <head>
          <meta charset="UTF-8" />
          <meta name="viewport" content="width=device-width, initial-scale=1.0" />
          <title>Replay Integration</title>
        </head>
        <body>
          <!-- Create an iframe with no src, but DO include the iframe id as "replay-iframe" -->
          <iframe
            id="replay-iframe"
            width="100%"
            height="100%"
            frameborder="0"
            border="none"
            allow="microphone; camera; clipboard-write;"
            style="
              background-color: red;
              position: absolute;
              left: 0;
              right: 0;
              bottom: 0;
              top: 0;
            "
          ></iframe>

          <!-- Use a script to combine the activity URL with your own, signed JWT -->
          <script>
            (async function () {
              const setIframeSource = async () => {
                try {
                  // Sign the JWT using your backend
                  const routeToSignJwt = "https://my-backend/sign-jwt"; // Replace with your actual backend URL
                  const response = await fetch(routeToSignJwt, {
                    headers: {}, // Don't forget any authentication headers!
                  });

                  if (!response.ok) throw new Error("Failed to generate JWT");

                  // Combined the signed JWT with the activity URL. Use the combined URL to set the iframe source
                  const activityUrl =
                    "http://localhost:3000/api/iframe/launch?activityId=bfaba734-35bf-41a2-9ca5-bbc4f5f04888&activityType=script&type=iframe";
                  const iframe = document.getElementById("replay-iframe");
                  const data = await response.json();
                  iframe.src = activityUrl + "&integrationJwt=" + data.token;
                } catch (error) {
                  console.error("Error setting iframe source:", error);
                }
              };

              // Set the iframe source when the document is ready
              document.addEventListener("DOMContentLoaded", () => setIframeSource());
            })();
          </script>
        </body>
      </html>
      ```

      ```javascript Script Example
      <!-- Use a script to combine the activity URL with your own, signed JWT -->
      <script>
        (async function () {
          const setIframeSource = async () => {
            try {
              // Sign the JWT using your backend
              const routeToSignJwt = "https://my-backend/sign-jwt"; // Replace with your actual backend URL
              const response = await fetch(routeToSignJwt, {
                headers: {}, // Don't forget any authentication headers!
              });

              if (!response.ok) throw new Error("Failed to generate JWT");

              // Combined the signed JWT with the activity URL. Use the combined URL to set the iframe source
              const activityUrl =
                "http://localhost:3000/api/iframe/launch?activityId=bfaba734-35bf-41a2-9ca5-bbc4f5f04888&activityType=script&type=iframe";
              const iframe = document.getElementById("replay-iframe");
              const data = await response.json();
              iframe.src = activityUrl + "&integrationJwt=" + data.token;
            } catch (error) {
              console.error("Error setting iframe source:", error);
            }
          };

          // Set the iframe source when the document is ready
          document.addEventListener("DOMContentLoaded", () => setIframeSource());
        })();
      </script>
      ```
    </CodeGroup>

## Message Passing

After the user completes the roleplay, the iframe will send messages to the parent window containing information about the user's performance and progress. To receive these messages, you'll need to set up an event listener in your parent window.

### Setting Up the Listener

Add this code to your parent window to receive messages from the Replay iframe:

```typescript
window.addEventListener('message', function(event) {
    // Only accept messages from your Replay domain
    if (event.origin !== 'https://app.replay.sale') return;

    console.log('Received message from iframe:', event.data);

    if (event.data.type === 'roleplay_result') {
        console.log('Score:', event.data.score);
        console.log('Full result:', event.data.result);
    }
});
```

### Message Interface

```typescript
interface IframeRoleplayResultsMessageData {
  type: "roleplay_result";
  score: number;
  results: RoleplayResult;  // Uses the RoleplayResult interface defined above
}
```

<Note>
  The message type will always be "roleplay_result" and will contain both the overall score and the complete results object.
</Note>

### Data Model

Below is the complete data model that you'll receive from the iframe messages.

**Please note** - we have additional fields available that we are not currently sending. If you're application needs more data that we are not currently sending, please contact us.

```typescript
interface RoleplayResult {
    // Unique identifier for the roleplay session
    id: string;

    // Performance metrics
    length: number; // Duration of the roleplay in milliseconds
    wpm: number; // Words per minute
    name_count: number; // Number of times names were mentioned
    num_questions: number; // Number of questions asked
    num_filler_words: number; // Number of filler words used
    score: number; // Overall score (0-100)

    // Timestamps
    created_at: string; // ISO timestamp - roughly equates to when the roleplay start time
    updated_at: string; // ISO timestamp - roughly equates to when the roleplay end time

    // User information
    user: {
        first_name: string;
        last_name: string;
        origin: string | null;
        integration_identifier: string | null;
    };

    // Roleplay configuration
    premade_roleplay: {
        title: string;
        passing_score: number;
    };

    // Conversation transcript
    snippets: Array<{
        is_user: boolean;
        text: string;
    }>;

    // Scenario details
    scenario: {
        title: string;
    };

    // Customer information
    customer_persona: {
        image_url: string;
        name: string;
    };

    customer_situation: {
        job_title: string;
        company_name: string;
    };

    // Evaluation criteria
    scorecard: {
        title: string;
    };

    // Evaluation responses
    prompt_responses: Array<{
        title: string;
        passed: boolean;
        explanation: string | null;
    }>;
}
```

### Example Response

Here's an example of what the response data looks like:

```javascript
{
    "id": "63da9aca-c1d0-4ce7-a7dd-9af07be150dd",
    "length": 10000,
    "wpm": 204,
    "name_count": 0,
    "num_questions": 0,
    "num_filler_words": 0,
    "score": 76.1,
    "expected_audio_url": "https://resynthesis.blob.core.windows.net/ceeea412-2ccb-4f97-a82a-a952e64f2935/full_recording/63da9aca-c1d0-4ce7-a7dd-9af07be150dd.ogg",
    "expected_video_url": "https://resynthesis.blob.core.windows.net/ceeea412-2ccb-4f97-a82a-a952e64f2935/converted_video_recording/63da9aca-c1d0-4ce7-a7dd-9af07be150dd.mp4",
    "created_at": "2024-12-11T21:28:34.120Z",
    "updated_at": "2024-12-11T21:29:14.482Z",
    "user": {
        "first_name": "Test",
        "last_name": "User",
        "origin": "https://app.replay.sale",
        "integration_identifier": "1234567890"
    },
    "premade_roleplay": {
        "title": "Discovery",
        "passing_score": 75
    },
    "snippets": [
        {
            "is_user": false,
            "text": "Hello?"
        },
        {
            "is_user": true,
            "text": "This is John Doe from Replay. I'm calling to see if you're interested in our new product."
        },
        {
            "is_user": false,
            "text": "Yeah, I'd love to sign up for a demo..."
        }
    ],
    "scenario": {
        "title": "Discovery"
    },
    "customer_persona": {
        "image_url": "https://randomuser.me/api/portraits/women/2.jpg",
        "name": "Karen"
    },
    "customer_situation": {
        "job_title": "Sales Manager",
        "company_name": "Acme, Inc."
    },
    "prompt_responses": [
        {
            "title": "Did the user set up a specific time for the demo?",
            "passed": false,
            "explanation": "No, the rep did not mention a specific time for the demo."
        },
        {
            "title": "Did the user mention Replay?",
            "passed": true,
            "explanation": "Yes, the rep mentioned Replay during the call. This is a passing response."
        }
        // ... additional prompt responses
    ]
}
```
